<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="3.css" />
</head>

<body>

    <div class="box">
        <div id="human_field" class="field"></div>
        <div id="computer_field" class="field"></div>
        <script>
            const FIELD_SIZE = 10;

            function deepEqual([x1, y1], [x2, y2]) {
                if (x1 === x2 && y1 === y2) return true;
                return false;
            }

            function createElement(name, x, y, field) {
                const div = document.createElement('div');
                div.className = name;
                div.style.cssText = `left:${(x + 1) * 40}px; top:${(y + 1) * 40}px;position: fixed;`;
                document.getElementById(field).appendChild(div);
            }
            class Field {
                alphabet = ["А", "Б", "В", "Г", "Д", "Е", "Ж", "З", "И", "К"];
                ships = [];
                field = [];
                constructor() {
                    for (let row = 0; row < FIELD_SIZE; row++) {
                        this.field[row] = [];
                        for (let col = 0; col < FIELD_SIZE; col++) {
                            this.field[row][col] = 0;
                        }
                    }
                }
                generateShips() {
                    for (let i = 4; i > 0; i--) {
                        for (let j = 1; j <= 5 - i; j++) {
                            let isCorrect = true;
                            do {
                                isCorrect = true;
                                var ship = new Ship(i);
                                for (let k = 0; k < this.ships.length; k++) {
                                    if (this.ships[k].isConnectTo(ship)) {
                                        isCorrect = false;
                                        break;
                                    }
                                }

                                /*this.ships.forEach(function(item) {
                                    console.log(item.isConnectTo(ship));
                                    if (item.isConnectTo(ship)) {
                                        isCorrect = false;
                                        //break
                                    }
                                });*/

                            } while (isCorrect === false);
                            this.ships.push(ship);
                            console.log("good");
                        }
                    }
                }
                showShips() {
                    this.ships.forEach(function(item) {
                        item.showShip();
                    });
                }
                hit(cell) {
                    let col = this.alphabet.indexOf(cell.charAt(0));
                    let row = Number(cell.charAt(1)) - 1;

                    if (this.field[row][col] === 1) return;
                    this.field[row, col] = 1;
                    for (let i = 0; i < this.ships.length; i++) {
                        if (this.ships[i].isHit(row, col)) {
                            createElement('cross', col, row, 'human_field');
                            if (this.ships[i].isAllHit()) {

                            }
                            return;
                        }
                    }
                    createElement('dot', col, row, 'human_field');
                }
            }

            function replace(coord, value) {
                if (coord[0] < 0 || coord[0] > 9) coord[0] = value;
                if (coord[1] < 0 || coord[1] > 9) coord[1] = value;
            }
            class Ship {
                hits = 0;
                name;
                row;
                col;
                size;
                direction;
                startCoord;
                finishCoord;
                coordinate = [];
                constructor(size) {
                    this.size = size;

                    this.direction = Math.floor(Math.random() * 2);
                    if (this.direction === 1) {
                        this.col = Math.floor(Math.random() * (FIELD_SIZE - this.size));
                        this.row = Math.floor(Math.random() * FIELD_SIZE);

                    } else {
                        this.row = Math.floor(Math.random() * (FIELD_SIZE - this.size));
                        this.col = Math.floor(Math.random() * FIELD_SIZE);
                    }
                    for (let i = 0; i < size; i++) {
                        if (this.direction === 1) this.coordinate.push([this.row, this.col + i]);
                        else this.coordinate.push([this.row + i, this.col]);
                    }
                    this.startCoord = [this.row - 1, this.col - 1];
                    replace(this.startCoord, 0);
                    if (this.direction === 1) this.finishCoord = [this.row + 1, this.col + size];
                    else this.finishCoord = [this.row + size, this.col + 1];
                    replace(this.finishCoord, 9);

                }
                showShip() {
                    const dir = (this.direction == 1) ? '' : ' vertical';
                    let name = 'ship deck' + this.size + dir;
                    createElement(name, this.col, this.row, 'human_field');
                }
                isHit(row, col) {
                    for (let i = 0; i < this.size; i++) {
                        if (deepEqual(this.coordinate[i], [row, col])) {
                            this.hits++;
                            return true;
                        }
                    }
                    return false;
                }
                isAllHit() {
                    if (this.hits === this.size) return true;
                    return false;
                }
                isConnectTo(ship) {
                    if (Math.abs(this.startCoord[0] - ship.startCoord[0]) > 1 && Math.abs(ship.finishCoord[0] - this.finishCoord[0]) > 1 || (Math.abs(this.startCoord[1] - ship.startCoord[1]) > 1 && Math.abs(ship.finishCoord[1] - this.finishCoord[1]) > 1)) return false;
                    return true;
                }
            }
            var test = new Field();

            function startGame() {

                test.generateShips();
                test.showShips();
                test.hit("А1");
                test.hit("А2");
            }

            function makeHit() {
                var text = document.search.place.value.trim();
                test.hit(text);
            }
        </script>
    </div>
    <form name="search" style="
    overflow: hidden;
    position: fixed;
    top: 85%;
    left: 50%;
    -webkit-transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    transform: translate(-50%, -50%);
    text-align: center;
    display: flex;">
        <input type="text" name="place" placeholder="Введите ячейку (пример: А1)" style="width:180px;" />
        <input type="button" name="hit" value="Выстрелить" style="width: 90px; margin-left:7px;" onclick="makeHit();" />
        <input type="button" name="start" value="Начать игру" style="width: 90px; margin-left:7px;" onclick="startGame();" />
    </form>
</body></html>
