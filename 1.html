<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="3.css" />
</head>

<body>

    <div class="box">
        <div id="print" style="width:930px;height: 40px;position: fixed;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–æ—Ä—Å–∫–æ–π –±–æ–π - –∏–≥—Ä—ã –Ω–∞ –¥–≤–æ–∏—Ö !</div>
        <div id="first_field" class="field"></div>
        <div style="width: 100px;">
            <input type="button" id="change" value="üóò" style="width: 40px;height:30px;margin-top:80%;display:none;" onclick="changeField();" />
        </div>
        <div id="second_field" class="field"></div>
        <script>
            const FIELD_SIZE = 10;

            function deepEqual([x1, y1], [x2, y2]) {
                if (x1 === x2 && y1 === y2) return true;
                return false;
            }

            function createElement(name, x, y, field) {
                const div = document.createElement('div');
                div.className = name;
                div.style.cssText = `margin-left:${(x + 1) * 40}px; margin-top:${(y + 1) * 40}px;position: fixed;`;
                document.getElementById(field).appendChild(div);
            }
            class Field {
                name;
                alphabet = ["–ê", "–ë", "–í", "–ì", "–î", "–ï", "–ñ", "–ó", "–ò", "–ö"];
                ships = [];
                field = [];
                constructor(name) {
                    this.name = name;
                    for (let row = 0; row < FIELD_SIZE; row++) {
                        this.field[row] = [];
                        for (let col = 0; col < FIELD_SIZE; col++) {
                            this.field[row][col] = 0;
                        }
                    }
                }
                generateShips() {
                    for (let i = 4; i > 0; i--) {
                        for (let j = 1; j <= 5 - i; j++) {
                            let isCorrect = true;
                            do {
                                isCorrect = true;
                                var ship = new Ship(i);
                                for (let k = 0; k < this.ships.length; k++) {
                                    if (this.ships[k].isConnectTo(ship)) {
                                        isCorrect = false;
                                        break;
                                    }
                                }

                                /*this.ships.forEach(function(item) {
                                    console.log(item.isConnectTo(ship));
                                    if (item.isConnectTo(ship)) {
                                        isCorrect = false;
                                        //break
                                    }
                                });*/

                            } while (isCorrect === false);
                            this.ships.push(ship);
                            console.log("good");
                        }
                    }
                }
                reset() {
                    this.ships = [];
                    document.getElementById(this.name).innerHTML = '';
                }
                showShips() {
                    name = this.name;
                    console.log(name);
                    this.ships.forEach(function(item) {
                        item.showShip(name);
                    });
                }
                hit(cell) {
                    let col = this.alphabet.indexOf(cell.charAt(0));
                    let row = Number(cell.charAt(1)) - 1;

                    if (this.field[row][col] === 1) return;
                    this.field[row, col] = 1;
                    for (let i = 0; i < this.ships.length; i++) {
                        if (this.ships[i].isHit(row, col)) {
                            createElement('cross', col, row, name);
                            if (this.ships[i].isAllHit()) {

                            }
                            return;
                        }
                    }
                    createElement('dot', col, row, name);
                }
            }

            function replace(coord, value) {
                if (coord[0] < 0 || coord[0] > 9) coord[0] = value;
                if (coord[1] < 0 || coord[1] > 9) coord[1] = value;
            }
            class Ship {
                hits = 0;
                name;
                row;
                col;
                size;
                direction;
                startCoord;
                finishCoord;
                coordinate = [];
                constructor(size) {
                    this.size = size;

                    this.direction = Math.floor(Math.random() * 2);
                    if (this.direction === 1) {
                        this.col = Math.floor(Math.random() * (FIELD_SIZE - this.size));
                        this.row = Math.floor(Math.random() * FIELD_SIZE);

                    } else {
                        this.row = Math.floor(Math.random() * (FIELD_SIZE - this.size));
                        this.col = Math.floor(Math.random() * FIELD_SIZE);
                    }
                    for (let i = 0; i < size; i++) {
                        if (this.direction === 1) this.coordinate.push([this.row, this.col + i]);
                        else this.coordinate.push([this.row + i, this.col]);
                    }
                    this.startCoord = [this.row - 1, this.col - 1];
                    replace(this.startCoord, 0);
                    if (this.direction === 1) this.finishCoord = [this.row + 1, this.col + size];
                    else this.finishCoord = [this.row + size, this.col + 1];
                    replace(this.finishCoord, 9);

                }
                showShip(fieldName) {
                    const dir = (this.direction == 1) ? '' : ' vertical';
                    let name = 'ship deck' + this.size + dir;
                    createElement(name, this.col, this.row, fieldName);
                }
                isHit(row, col) {
                    for (let i = 0; i < this.size; i++) {
                        if (deepEqual(this.coordinate[i], [row, col])) {
                            this.hits++;
                            return true;
                        }
                    }
                    return false;
                }
                isAllHit() {
                    if (this.hits === this.size) return true;
                    return false;
                }
                isConnectTo(ship) {
                    if ((Math.abs(this.startCoord[0] - ship.startCoord[0]) > 1 && Math.abs(ship.finishCoord[0] - this.finishCoord[0]) > 1 || (Math.abs(this.startCoord[1] - ship.startCoord[1]) > 1 && Math.abs(ship.finishCoord[1] - this.finishCoord[1]) > 1))) return false;
                    return true;
                }
            }
            var firstPlayer = new Field("first_field");
            var secondPlayer = new Field("second_field");
            var PLAYER = 1;
            var firstClick = true;

            function chooseField() {
                if (firstClick) {
                    console.log(1);
                    search.start.value = "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å";
                    document.getElementById('change').style.display = 'inline';
                    firstPlayer.generateShips();
                    firstPlayer.showShips();
                    firstClick = false;
                } else {
                    console.log(2);
                    PLAYER = 2;
                    search.start.style.display = 'none';
                    search.ready.style.display = 'inline';
                    secondPlayer.generateShips();
                    secondPlayer.showShips();
                }
            }

            function changeField() {
                let curField = (PLAYER === 1) ? firstPlayer : secondPlayer;
                console.log(curField);
                curField.reset();
                curField.generateShips();
                curField.showShips();
            }

            function startGame() {
                search.ready.style.display = 'none';
            }

            function makeHit() {
                var text = document.search.place.value.trim();
                test.hit(text);
            }

        </script>
        <form name="search" style="

    position: fixed;
    top: 68%;
   width:930px;
    text-align: center;">
            <input type="button" name="start" value="–í–ø–µ—Ä–µ–¥" style="width: 90px;left:50%;" onclick="chooseField();" />
            <input type="button" name="ready" value="–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" style="width: 90px;top:50%;left:50%;display: none;" onclick="startGame();" />
            <br>
            <input type="text" name="cell" placeholder="–í–≤–µ–¥–∏—Ç–µ —è—á–µ–π–∫—É (–ø—Ä–∏–º–µ—Ä: –ê1)" style="width:180px;display: none;" />
            <input type="button" name="hit" value="–í—ã—Å—Ç—Ä–µ–ª–∏—Ç—å" style="width: 90px; margin-left:7px;display: none;" onclick="makeHit();" />
        </form>
    </div>

</body>

</html>
